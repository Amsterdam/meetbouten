name: Opdrachten Team Dependabot

on:
  pull_request:
    branches: main

jobs:
  update-dependencies:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v3

    - name: Update dependencies
      run: make requirements

    - name: Build
      run: make build

    - name: Test
      run: make test

    - name: Get current date
      id: date
      run: echo "::set-output name=date::$(date +'%Y-%m-%d')"

    - name: Create Pull Request
      uses: peter-evans/create-pull-request@v5
      with:
        commit-message: Updated dependencies
        committer: Opdrachten Team Dependabot <opdrachten-team-dependabot@amsterdam.nl>
        body: |
          New report
          - Contains *today's* date
          - Auto-generated by [create-pull-request][1]
  
          [1]: https://github.com/peter-evans/create-pull-request
        title: '[Example] Add report file'
        labels: report, automated pr
        branch: example-patches

    - uses: someimportantcompany/github-actions-slack-message@v1
      with:
        channel: ${{ env.SLACK_CHANNEL }}
        bot-token: ${{ secrets.SLACK_BOT_TOKEN }}
        text: Firing a bot-token message